# Моделирование качения шаров с учётом трения

Комплексная симуляция движения шаров по поверхностям с учётом физических эффектов: гравитация, трение качения, трение скольжения, упругие соударения между шарами и контакт с границами.

## Описание проекта

Программа реализует многофункциональный физический симулятор, позволяющий моделировать динамику сферических объектов в различных сценариях. Система учитывает как поступательное, так и вращательное движение шаров, а также сложные взаимодействия через контактные силы и моменты.

## Математическая модель

### Уравнения движения

Для каждого шара система решает два векторных дифференциальных уравнения:

**Поступательное движение (второй закон Ньютона):**
$$m\frac{d^2\vec{r}}{dt^2} = \vec{F}_{total}$$

где суммарная сила включает: гравитацию, нормальные контактные силы, силы трения, и силы от столкновений с другими шарами.

**Вращательное движение (уравнение моментов):**
$$I\frac{d\vec{\omega}}{dt} = \vec{\tau}_{total}$$

где $$\(I = 0.4mR^2\)$$ — момент инерции однородного шара, $$\(\vec{\tau}_{total}\)$$ — суммарный момент контактных и трения.

### Моделирование контактных сил

**Нормальная сила:**

При проникновении шара на глубину $$\(\delta = R - d\)$$ в контактную поверхность:

$$F_n = k\delta - c\dot{\delta}$$

где:
$$- \(k = 2 \times 10^4 m\)$$ — коэффициент жёсткости контакта
$$- \(c = 2\zeta\sqrt{km}\)$$ — коэффициент демпфирования
$$- \(\zeta = \frac{\ln e}{\sqrt{\pi^2 + (\ln e)^2}}\)$$ — коэффициент затухания, зависящий от коэффициента восстановления $$\(e\)$$

Этот подход обеспечивает физически обоснованное затухание энергии при соударениях.

**Тангенциальная сила трения:**

$$\vec{F}_t = -\mu F_n \frac{\vec{v}_t}{|\vec{v}_t|}$$

где $$\(\mu\)$$ — коэффициент трения, $$\(\vec{v}_t\)$$ — тангенциальная компонента скорости в точке контакта, включающая вклад вращения:

$$\vec{v}_t = \vec{v}_{центра} + \vec{\omega} \times \vec{r}_{контакта} - (\vec{v}_{центра} \cdot \vec{n})\vec{n}$$

**Столкновения между шарами:**

Для взаимодействия двух шаров используется приведённая масса:

$$m_{eff} = \frac{m_1 m_2}{m_1 + m_2}$$

и аналогичная система контактных сил, что обеспечивает корректный расчёт импульсов при столкновениях.

### Энергия системы

Полная кинетическая энергия состоит из поступательной и вращательной компонент:

$$E_{total} = \sum_i \left( \frac{1}{2}m_i|\vec{v}_i|^2 + \frac{1}{2}I_i|\vec{\omega}_i|^2 \right)$$

Система отслеживает энергию на всём протяжении моделирования, что позволяет верифицировать правильность диссипации через трение.

- **Максимальное количество точек вывода**: 1000 для оптимизации визуализации

### Вектор состояния

Каждый шар представлен пятью переменными состояния:

$$\vec{y}_i = [x_i, y_i, v_{x,i}, v_{y,i}, \omega_{z,i}]$$

Общее количество ODE равно $$\(5N\)$$, где $$\(N\)$$ — число шаров.


## Сценарии моделирования

### 1. Скатывание по наклонной плоскости

Демонстрирует влияние угла наклона и коэффициента трения на ускорение и энергетику:

- Шар начинает с отдыха на высоте $$\(y_0\)$$
- Гравитационная компонента вдоль поверхности ускоряет движение
- Трение и вращение рассеивают энергию
- Сценарий полезен для изучения перехода между качением и проскальзыванием

**Параметры по умолчанию:**
- Угол наклона: 30°
- Коэффициент трения: 0.3
- Начальная высота: 0.3 м
- Радиус шара: 0.05 м

### 2. Качение по горизонтальной плоскости

Множественные шары взаимодействуют друг с другом и со стенками закрытой области:

- Шары имеют начальные скорости в разных направлениях
- Демонстрирует сложные многотельные столкновения
- Трение постепенно затухает движение
- Визуализирует траектории и эволюцию энергии

**Параметры по умолчанию:**
- Количество шаров: 2
- Ширина области: 1.8 м
- Высота области: 0.9 м
- Коэффициент трения: 0.2
- Коэффициент восстановления: 0.98

### 3. Упругие столкновения

Идеализированный сценарий без гравитации и трения для чистого изучения законов сохранения:

- Два шара движутся навстречу друг другу в замкнутом объёме
- Без трения на поверхностях
- Демонстрирует законы сохранения импульса и (при $$e=1$$) энергии
- Полезен для верификации алгоритма столкновений

**Параметры по умолчанию:**
- Коэффициент восстановления: 0.98
- Ширина области: 2.0 м
- Высота области: 1.0 м


### Автотесты

Три встроенных теста проверяют:

1. **Сохранение энергии** при отсутствии контактных сил
2. **Диссипацию энергии** из-за трения и контактных деформаций
3. **Корректность столкновений** между шарами

## Параметры системы

### Диапазоны параметров

| Параметр | Минимум | Максимум | По умолчанию |
|----------|---------|----------|--------------|
| Масса шара | 0.05 кг | 10.0 кг | 1.0 кг |
| Радиус шара | 0.01 м | 0.2 м | 0.04-0.05 м |
| Коэффициент трения | 0.0 | 2.0 | 0.1-0.3 |
| Коэффициент восстановления | 0.0 | 1.0 | 0.98 |
| Угол наклона | 0° | 85° | 30° |
| Ширина области | 0.5 м | 6.0 м | 1.8-2.0 м |
| Высота области | 0.3 м | 4.0 м | 0.9-1.0 м |
| Гравитация | — | — | 9.81 м/с² |
| Время симуляции | 0.05 с | 5.0 с | 0.41 с |

### Жёсткость контакта

Коэффициент жёсткости $$\(k = 2 \times 10^4 m\)$$ подобран для типичных параметров, обеспечивая:

- Достаточно малые деформации для физической реалистичности
- Достаточно жёсткие контакты для численной стабильности
- 

## Примеры результатов

### Скатывание: энергетика с разными коэффициентами трения

При увеличении коэффициента трения от 0 до 1 энергия рассеивается быстрее, а конечная скорость шара снижается. Вращательная энергия становится значительной из-за сильного взаимодействия с поверхностью.

### Горизонтальная поверхность: столкновение шаров

Два шара с равными массами, движущиеся навстречу друг другу, при упругом столкновении обмениваются скоростями. При неупругом столкновении $$(e < 1) $$скорости после столкновения снижаются в соответствии с законом сохранения импульса.

### Упругие столкновения: проверка законов

При $$e = 1.0$$ и нулевой гравитации система демонстрирует идеальное упругое рассеяние, с полным сохранением энергии до численных ошибок.
